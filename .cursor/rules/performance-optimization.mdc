# æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

é’ˆå¯¹è¯­éŸ³è½¬æ–‡å­—åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–æŒ‡å—ï¼š

## ğŸ™ï¸ éŸ³é¢‘å¤„ç†ä¼˜åŒ–
- **æµå¼å¤„ç†**ï¼šä½¿ç”¨æµå¼éŸ³é¢‘å¤„ç†ï¼Œé¿å…åŠ è½½æ•´ä¸ªéŸ³é¢‘æ–‡ä»¶åˆ°å†…å­˜
- **é‡‡æ ·ç‡ä¼˜åŒ–**ï¼šç»Ÿä¸€ä½¿ç”¨ 16kHz é‡‡æ ·ç‡ï¼Œé¿å…ä¸å¿…è¦çš„é‡é‡‡æ ·
- **ç¼“å†²åŒºå¤§å°**ï¼šä½¿ç”¨ 6400 å­—èŠ‚çš„éŸ³é¢‘å—ï¼Œä¸è±†åŒ… API è¦æ±‚ä¿æŒä¸€è‡´
- **å‹ç¼©ä¼ è¾“**ï¼šå¯¹éŸ³é¢‘æ•°æ®ä½¿ç”¨ gzip å‹ç¼©å‡å°‘ç½‘ç»œä¼ è¾“

```typescript
// ä¼˜åŒ–çš„éŸ³é¢‘æ•°æ®åˆ†å—å¤„ç†
const CHUNK_SIZE = 6400; // bytes
const chunks = [];
for (let i = 0; i < audioBuffer.length; i += CHUNK_SIZE) {
  chunks.push(audioBuffer.slice(i, i + CHUNK_SIZE));
}
```

## ğŸŒ ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- **è¿æ¥å¤ç”¨**ï¼šWebSocket è¿æ¥å°½å¯èƒ½å¤ç”¨ï¼Œé¿å…é¢‘ç¹å»ºç«‹è¿æ¥
- **è¶…æ—¶è®¾ç½®**ï¼šè®¾ç½®åˆç†çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆå»ºè®® 30 ç§’ï¼‰
- **é‡è¯•æœºåˆ¶**ï¼šå®ç°æŒ‡æ•°é€€é¿çš„é‡è¯•ç­–ç•¥
- **å¹¶å‘æ§åˆ¶**ï¼šé™åˆ¶åŒæ—¶è¿›è¡Œçš„è½¬å½•è¯·æ±‚æ•°é‡

## ğŸ’¾ å†…å­˜ç®¡ç†
- **åŠæ—¶é‡Šæ”¾**ï¼šéŸ³é¢‘å¤„ç†å®Œæˆåç«‹å³é‡Šæ”¾å¤§çš„ Buffer å¯¹è±¡
- **å¯¹è±¡æ± **ï¼šå¯¹äºé¢‘ç¹åˆ›å»ºçš„å°å¯¹è±¡ä½¿ç”¨å¯¹è±¡æ± æ¨¡å¼
- **å¼±å¼•ç”¨**ï¼šå¯¹äºç¼“å­˜æ•°æ®ä½¿ç”¨ WeakMap é¿å…å†…å­˜æ³„æ¼

```typescript
// å†…å­˜ä¼˜åŒ–çš„éŸ³é¢‘å¤„ç†
function processAudioChunk(chunk: Buffer): void {
  try {
    // å¤„ç†éŸ³é¢‘å—
    sendAudioChunk(chunk);
  } finally {
    // ç¡®ä¿é‡Šæ”¾å†…å­˜
    chunk = null;
  }
}
```

## âš›ï¸ React æ€§èƒ½ä¼˜åŒ–
- **useMemo ç¼“å­˜**ï¼šå¯¹å¤æ‚è®¡ç®—ä½¿ç”¨ useMemo ç¼“å­˜ç»“æœ
- **useCallback ç¨³å®š**ï¼šä¸ºä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°ä½¿ç”¨ useCallback
- **çŠ¶æ€åˆ†ç¦»**ï¼šå°†é¢‘ç¹æ›´æ–°çš„çŠ¶æ€ä¸å…¶ä»–çŠ¶æ€åˆ†ç¦»
- **ç»„ä»¶æ‹†åˆ†**ï¼šå°†å¤§ç»„ä»¶æ‹†åˆ†ä¸ºæ›´å°çš„ç»„ä»¶å‡å°‘é‡æ¸²æŸ“

```typescript
// React æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹
const TranscriptionComponent = () => {
  // ç¼“å­˜å¤æ‚è®¡ç®—
  const processedText = useMemo(() => {
    return formatTranscriptionText(transcriptionResult.text);
  }, [transcriptionResult.text]);

  // ç¨³å®šçš„äº‹ä»¶å¤„ç†å‡½æ•°
  const handleTextChange = useCallback((newText: string) => {
    setTranscriptionResult(prev => ({ ...prev, text: newText }));
  }, []);

  return <Form.TextArea value={processedText} onChange={handleTextChange} />;
};
```

## ğŸ“ æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
- **å¼‚æ­¥ IO**ï¼šä½¿ç”¨å¼‚æ­¥æ–‡ä»¶æ“ä½œé¿å…é˜»å¡ä¸»çº¿ç¨‹
- **æµå¼è¯»å†™**ï¼šå¯¹å¤§æ–‡ä»¶ä½¿ç”¨æµå¼å¤„ç†
- **ä¸´æ—¶æ–‡ä»¶æ¸…ç†**ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
- **é…ç½®ç¼“å­˜**ï¼šç¼“å­˜é…ç½®æ–‡ä»¶è¯»å–ç»“æœ

## ğŸ”„ çŠ¶æ€æ›´æ–°ä¼˜åŒ–
- **æ‰¹é‡æ›´æ–°**ï¼šä½¿ç”¨ React çš„è‡ªåŠ¨æ‰¹å¤„ç†æˆ–æ‰‹åŠ¨æ‰¹å¤„ç†çŠ¶æ€æ›´æ–°
- **é˜²æŠ–å¤„ç†**ï¼šå¯¹é¢‘ç¹çš„ç”¨æˆ·è¾“å…¥ä½¿ç”¨é˜²æŠ–å¤„ç†
- **æœ€å°åŒ–é‡æ¸²æŸ“**ï¼šåªæ›´æ–°å¿…è¦çš„ç»„ä»¶çŠ¶æ€

## ğŸ¯ ç®—æ³•ä¼˜åŒ–
- **æ—©æœŸè¿”å›**ï¼šåœ¨æ¡ä»¶æ£€æŸ¥ä¸­ä½¿ç”¨æ—©æœŸè¿”å›å‡å°‘åµŒå¥—
- **ç¼“å­˜è®¡ç®—**ï¼šç¼“å­˜æ˜‚è´µçš„è®¡ç®—ç»“æœ
- **æ‡’åŠ è½½**ï¼šå»¶è¿ŸåŠ è½½éå…³é”®åŠŸèƒ½æ¨¡å—

```typescript
// ä¼˜åŒ–çš„é…ç½®æ£€æŸ¥å‡½æ•°
function isConfigured(prefs: TranscriptionPreferences): boolean {
  // æ—©æœŸè¿”å›å‡å°‘è®¡ç®—
  if (!prefs.doubaoAppKey) return false;
  if (!prefs.doubaoAccessToken) return false;
  if (!prefs.doubaoSecretKey) return false;
  
  return true;
}
```

## ğŸ“Š æ€§èƒ½ç›‘æ§
- **å…³é”®æŒ‡æ ‡**ï¼šç›‘æ§éŸ³é¢‘å¤„ç†æ—¶é—´ã€ç½‘ç»œè¯·æ±‚å»¶è¿Ÿã€å†…å­˜ä½¿ç”¨
- **æ€§èƒ½æ—¥å¿—**ï¼šè®°å½•å…³é”®æ“ä½œçš„æ‰§è¡Œæ—¶é—´
- **èµ„æºè·Ÿè¸ª**ï¼šè·Ÿè¸ªéŸ³é¢‘æ–‡ä»¶å¤§å°ã€è½¬å½•å­—ç¬¦æ•°ç­‰èµ„æºä½¿ç”¨

```typescript
// æ€§èƒ½ç›‘æ§ç¤ºä¾‹
async function transcribeWithMetrics(audioBuffer: Buffer) {
  const startTime = Date.now();
  const audioSize = audioBuffer.length;
  
  try {
    const result = await transcribeAudio(audioBuffer);
    const duration = Date.now() - startTime;
    
    logger.info("Performance", "Transcription completed", {
      audioSize,
      duration,
      textLength: result.text.length,
      throughput: audioSize / duration
    });
    
    return result;
  } catch (error) {
    logger.error("Performance", "Transcription failed", { 
      audioSize, 
      duration: Date.now() - startTime 
    });
    throw error;
  }
}
```
description:
globs:
alwaysApply: false
---
